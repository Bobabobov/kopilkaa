// prisma/schema.prisma
datasource db {
  provider = "sqlite"      // если решишь перейти на Postgres — скажешь, переделаем URL/миграции
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id           String          @id @default(cuid())
  email        String          @unique
  passwordHash String
  name         String?
  role         String          @default("USER")
  createdAt    DateTime        @default(now())

  applications Application[]
}

model Application {
  id           String             @id @default(cuid())
  userId       String
  user         User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  title        String
  summary      String
  story        String
  payment      String
  status       ApplicationStatus  @default(PENDING)
  adminComment String?
  createdAt    DateTime           @default(now())

  images       ApplicationImage[]

  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model ApplicationImage {
  id            String   @id @default(cuid())
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  url           String
  sort          Int

  @@index([applicationId])
  @@index([sort])
}
