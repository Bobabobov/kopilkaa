<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>City Bloxx - –ë–∞—à–Ω—è –∏–∑ –±–ª–æ–∫–æ–≤</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        overflow: hidden;
      }

      .game-container {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 20px;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      .game-header {
        text-align: center;
        margin-bottom: 20px;
        color: white;
      }

      .game-title {
        font-size: 2.5em;
        font-weight: bold;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      .score-display {
        font-size: 1.5em;
        font-weight: bold;
        color: #ffd700;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      }

      .game-canvas {
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 15px;
        background: linear-gradient(to bottom, #87ceeb 0%, #98fb98 100%);
        display: block;
        margin: 0 auto;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .controls {
        text-align: center;
        margin-top: 20px;
        color: white;
      }

      .control-button {
        background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 1.2em;
        font-weight: bold;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        margin: 0 10px;
      }

      .control-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .control-button:active {
        transform: translateY(0);
      }

      .instructions {
        color: rgba(255, 255, 255, 0.8);
        font-size: 1em;
        margin-top: 15px;
        text-align: center;
      }

      .game-over {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        display: none;
      }

      .game-over h2 {
        color: #ff6b6b;
        margin-bottom: 15px;
      }

      .final-score {
        font-size: 1.5em;
        color: #ffd700;
        margin-bottom: 20px;
      }

      @media (max-width: 768px) {
        .game-title {
          font-size: 2em;
        }

        .game-canvas {
          width: 300px;
          height: 500px;
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="game-header">
        <h1 class="game-title">üèóÔ∏è City Bloxx</h1>
        <div class="score-display">
          –í—ã—Å–æ—Ç–∞: <span id="score">0</span> –±–ª–æ–∫–æ–≤
        </div>
      </div>

      <canvas
        id="gameCanvas"
        class="game-canvas"
        width="400"
        height="600"
      ></canvas>

      <div class="controls">
        <button class="control-button" id="startButton">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        <button class="control-button" id="restartButton" style="display: none">
          –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
        </button>
        <div class="instructions">
          –ö–ª–∏–∫–Ω–∏—Ç–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –±–ª–æ–∫–∞
        </div>
      </div>

      <div class="game-over" id="gameOver">
        <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
        <div class="final-score">
          –í—ã—Å–æ—Ç–∞ –±–∞—à–Ω–∏: <span id="finalScore">0</span> –±–ª–æ–∫–æ–≤
        </div>
        <button class="control-button" onclick="restartGame()">
          –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
        </button>
      </div>
    </div>

    <script>
      // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      const scoreElement = document.getElementById("score");
      const startButton = document.getElementById("startButton");
      const restartButton = document.getElementById("restartButton");
      const gameOverDiv = document.getElementById("gameOver");
      const finalScoreElement = document.getElementById("finalScore");

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã
      const GAME_CONFIG = {
        BLOCK_WIDTH: 60,
        BLOCK_HEIGHT: 40,
        CRANE_HEIGHT: 100,
        CRANE_WIDTH: 20,
        ROPE_LENGTH: 150,
        SWING_SPEED: 0.02,
        FALL_SPEED: 8,
        TOLERANCE: 25, // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
        CANVAS_WIDTH: 400,
        CANVAS_HEIGHT: 600,
      };

      // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
      let gameState = {
        isPlaying: false,
        score: 0,
        tower: [],
        currentBlock: null,
        craneAngle: 0,
        craneDirection: 1,
        gameSpeed: 1,
        blockImages: [],
        imagesLoaded: 0,
      };

      // –¢–∏–ø—ã –±–ª–æ–∫–æ–≤ –∏–∑ –ø–∞–ø–∫–∏ Default
      const BLOCK_TYPES = [
        "extra_box_coin.png",
        "extra_box_exclamation.png",
        "extra_crate_explosive.png",
        "extra_crate.png",
        "extra_dirt_detail.png",
        "extra_dirt_top.png",
        "extra_dirt.png",
        "extra_stone_detail.png",
        "extra_stone_top.png",
        "extra_stone.png",
      ];

      // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
      function loadImages() {
        BLOCK_TYPES.forEach((imageName, index) => {
          const img = new Image();
          img.onload = () => {
            gameState.imagesLoaded++;
            if (gameState.imagesLoaded === BLOCK_TYPES.length) {
              console.log("–í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã");
            }
          };
          img.src = `./Default/${imageName}`;
          gameState.blockImages.push(img);
        });
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
      function initGame() {
        gameState.isPlaying = true;
        gameState.score = 0;
        gameState.tower = [];
        gameState.craneAngle = 0;
        gameState.craneDirection = 1;
        gameState.gameSpeed = 1;

        // –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—ã–π –±–ª–æ–∫
        spawnNewBlock();

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        updateUI();

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        gameLoop();
      }

      // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±–ª–æ–∫–∞
      function spawnNewBlock() {
        const randomBlockType = Math.floor(Math.random() * BLOCK_TYPES.length);
        const craneX = GAME_CONFIG.CANVAS_WIDTH / 2;
        const craneY = GAME_CONFIG.CRANE_HEIGHT;

        gameState.currentBlock = {
          type: randomBlockType,
          x: craneX + Math.sin(gameState.craneAngle) * GAME_CONFIG.ROPE_LENGTH,
          y: craneY + GAME_CONFIG.ROPE_LENGTH,
          width: GAME_CONFIG.BLOCK_WIDTH,
          height: GAME_CONFIG.BLOCK_HEIGHT,
          isFalling: false,
          fallSpeed: 0,
        };
      }

      // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –±–ª–æ–∫–∞
      function placeBlock() {
        if (!gameState.currentBlock || gameState.currentBlock.isFalling) return;

        const block = gameState.currentBlock;
        const towerHeight = gameState.tower.length;
        const groundY =
          GAME_CONFIG.CANVAS_HEIGHT - towerHeight * GAME_CONFIG.BLOCK_HEIGHT;

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –±–ª–æ–∫–∞
        let finalX = block.x;
        let finalWidth = block.width;

        // –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –±–ª–æ–∫, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ
        if (towerHeight > 0) {
          const prevBlock = gameState.tower[towerHeight - 1];
          const offset = Math.abs(block.x - prevBlock.x);

          if (offset > GAME_CONFIG.TOLERANCE) {
            // –ë–ª–æ–∫ —Å–ª–∏—à–∫–æ–º —Å–º–µ—â–µ–Ω - –∏–≥—Ä–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è
            endGame();
            return;
          } else if (offset > 0) {
            // –û–±—Ä–µ–∑–∞–µ–º –≤—ã—Å—Ç—É–ø–∞—é—â—É—é —á–∞—Å—Ç—å
            const overlap = Math.max(
              0,
              (block.width + prevBlock.width) / 2 - offset,
            );
            finalWidth = block.width - overlap;

            // –°–º–µ—â–∞–µ–º –±–ª–æ–∫ –∫ —Ü–µ–Ω—Ç—Ä—É –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ
            if (block.x > prevBlock.x) {
              finalX = prevBlock.x + (prevBlock.width - finalWidth) / 2;
            } else {
              finalX = prevBlock.x - (prevBlock.width - finalWidth) / 2;
            }
          }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ –≤ –±–∞—à–Ω—é
        gameState.tower.push({
          type: block.type,
          x: finalX,
          y: groundY,
          width: finalWidth,
          height: block.height,
        });

        gameState.score++;
        gameState.gameSpeed = Math.min(gameState.gameSpeed + 0.1, 3);

        // –°–æ–∑–¥–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫
        setTimeout(() => {
          spawnNewBlock();
        }, 300);
      }

      // –û–∫–æ–Ω—á–∞–Ω–∏–µ –∏–≥—Ä—ã
      function endGame() {
        gameState.isPlaying = false;
        finalScoreElement.textContent = gameState.score;
        gameOverDiv.style.display = "block";
        updateUI();
      }

      // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
      function restartGame() {
        gameOverDiv.style.display = "none";
        initGame();
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
      function updateUI() {
        scoreElement.textContent = gameState.score;
        startButton.style.display = gameState.isPlaying ? "none" : "block";
        restartButton.style.display = gameState.isPlaying ? "none" : "block";
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä—ã
      function render() {
        // –û—á–∏—â–∞–µ–º canvas
        ctx.clearRect(
          0,
          0,
          GAME_CONFIG.CANVAS_WIDTH,
          GAME_CONFIG.CANVAS_HEIGHT,
        );

        // –†–∏—Å—É–µ–º —Ñ–æ–Ω
        drawBackground();

        // –†–∏—Å—É–µ–º –±–∞—à–Ω—é
        drawTower();

        // –†–∏—Å—É–µ–º –∫—Ä–∞–Ω
        drawCrane();

        // –†–∏—Å—É–µ–º —Ç–µ–∫—É—â–∏–π –±–ª–æ–∫
        if (gameState.currentBlock) {
          drawCurrentBlock();
        }
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ñ–æ–Ω–∞
      function drawBackground() {
        // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
        const gradient = ctx.createLinearGradient(
          0,
          0,
          0,
          GAME_CONFIG.CANVAS_HEIGHT,
        );
        gradient.addColorStop(0, "#87CEEB");
        gradient.addColorStop(1, "#98FB98");

        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, GAME_CONFIG.CANVAS_WIDTH, GAME_CONFIG.CANVAS_HEIGHT);

        // –ó–µ–º–ª—è
        ctx.fillStyle = "#8B4513";
        ctx.fillRect(
          0,
          GAME_CONFIG.CANVAS_HEIGHT - 20,
          GAME_CONFIG.CANVAS_WIDTH,
          20,
        );
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫—Ä–∞–Ω–∞
      function drawCrane() {
        const craneX = GAME_CONFIG.CANVAS_WIDTH / 2;
        const craneY = GAME_CONFIG.CRANE_HEIGHT;

        // –û—Å–Ω–æ–≤–∞–Ω–∏–µ –∫—Ä–∞–Ω–∞
        ctx.fillStyle = "#2C3E50";
        ctx.fillRect(
          craneX - GAME_CONFIG.CRANE_WIDTH / 2,
          craneY - GAME_CONFIG.CRANE_HEIGHT,
          GAME_CONFIG.CRANE_WIDTH,
          GAME_CONFIG.CRANE_HEIGHT,
        );

        // –°—Ç—Ä–µ–ª–∞ –∫—Ä–∞–Ω–∞
        ctx.strokeStyle = "#34495E";
        ctx.lineWidth = 8;
        ctx.beginPath();
        ctx.moveTo(craneX, craneY);
        ctx.lineTo(
          craneX + Math.sin(gameState.craneAngle) * GAME_CONFIG.ROPE_LENGTH,
          craneY + GAME_CONFIG.ROPE_LENGTH,
        );
        ctx.stroke();

        // –ö—Ä—é–∫
        ctx.fillStyle = "#E74C3C";
        ctx.beginPath();
        ctx.arc(
          craneX + Math.sin(gameState.craneAngle) * GAME_CONFIG.ROPE_LENGTH,
          craneY + GAME_CONFIG.ROPE_LENGTH,
          5,
          0,
          Math.PI * 2,
        );
        ctx.fill();
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –±–∞—à–Ω–∏
      function drawTower() {
        gameState.tower.forEach((block, index) => {
          if (gameState.blockImages[block.type]) {
            ctx.drawImage(
              gameState.blockImages[block.type],
              block.x - block.width / 2,
              block.y,
              block.width,
              block.height,
            );
          } else {
            // Fallback –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
            ctx.fillStyle = `hsl(${block.type * 36}, 70%, 50%)`;
            ctx.fillRect(
              block.x - block.width / 2,
              block.y,
              block.width,
              block.height,
            );
          }
        });
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –±–ª–æ–∫–∞
      function drawCurrentBlock() {
        const block = gameState.currentBlock;

        if (gameState.blockImages[block.type]) {
          ctx.drawImage(
            gameState.blockImages[block.type],
            block.x - block.width / 2,
            block.y,
            block.width,
            block.height,
          );
        } else {
          // Fallback –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
          ctx.fillStyle = `hsl(${block.type * 36}, 70%, 50%)`;
          ctx.fillRect(
            block.x - block.width / 2,
            block.y,
            block.width,
            block.height,
          );
        }
      }

      // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
      function gameLoop() {
        if (!gameState.isPlaying) return;

        // –û–±–Ω–æ–≤–ª—è–µ–º —É–≥–æ–ª –∫—Ä–∞–Ω–∞
        gameState.craneAngle +=
          gameState.craneDirection *
          gameState.gameSpeed *
          GAME_CONFIG.SWING_SPEED;

        if (gameState.craneAngle > 0.5) {
          gameState.craneDirection = -1;
        } else if (gameState.craneAngle < -0.5) {
          gameState.craneDirection = 1;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Ç–µ–∫—É—â–µ–≥–æ –±–ª–æ–∫–∞
        if (gameState.currentBlock) {
          const craneX = GAME_CONFIG.CANVAS_WIDTH / 2;
          const craneY = GAME_CONFIG.CRANE_HEIGHT;

          gameState.currentBlock.x =
            craneX + Math.sin(gameState.craneAngle) * GAME_CONFIG.ROPE_LENGTH;
          gameState.currentBlock.y = craneY + GAME_CONFIG.ROPE_LENGTH;
        }

        // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–≥—Ä—É
        render();

        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ü–∏–∫–ª
        requestAnimationFrame(gameLoop);
      }

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
      function handleClick() {
        if (gameState.isPlaying && gameState.currentBlock) {
          placeBlock();
        }
      }

      function handleKeyPress(event) {
        if (event.code === "Space") {
          event.preventDefault();
          handleClick();
        }
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      canvas.addEventListener("click", handleClick);
      document.addEventListener("keydown", handleKeyPress);
      startButton.addEventListener("click", initGame);
      restartButton.addEventListener("click", restartGame);

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
      loadImages();

      // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      function resizeCanvas() {
        const container = canvas.parentElement;
        const containerWidth = container.clientWidth;

        if (window.innerWidth <= 768) {
          canvas.width = 300;
          canvas.height = 500;
          GAME_CONFIG.CANVAS_WIDTH = 300;
          GAME_CONFIG.CANVAS_HEIGHT = 500;
        } else {
          canvas.width = 400;
          canvas.height = 600;
          GAME_CONFIG.CANVAS_WIDTH = 400;
          GAME_CONFIG.CANVAS_HEIGHT = 600;
        }
      }

      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();

      console.log('City Bloxx –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É" –¥–ª—è —Å—Ç–∞—Ä—Ç–∞.');
    </script>
  </body>
</html>
