# Настройка платёжной системы (ЮKassa)

## Что это такое?

ЮKassa — это платёжная система от ЮMoney, которая позволяет принимать платежи на сайте. Подходит для самозанятых и ИП в России.

## Пошаговая инструкция

### 1. Регистрация в ЮKassa

1. Зайди на https://yookassa.ru/
2. Нажми "Подключиться" или "Войти"
3. Зарегистрируйся (нужен будет паспорт и данные для самозанятого/ИП)
4. Подтверди личность (это может занять 1-2 дня)

### 2. Получение ключей

1. После подтверждения зайди в личный кабинет
2. Перейди в раздел "Настройки" → "API"
3. Скопируй:
   - **Shop ID** (это твой идентификатор магазина)
   - **Secret Key** (секретный ключ для API)

### 3. Установка SDK

В папке проекта выполни команду:

```bash
npm install @yookassa/sdk
```

### 4. Настройка переменных окружения

Открой файл `.env.local` (если его нет — создай) и добавь:

```env
YOOKASSA_SHOP_ID=твой_shop_id_здесь
YOOKASSA_SECRET_KEY=твой_secret_key_здесь
NEXT_PUBLIC_SITE_URL=https://твой-домен.ru
```

**ВАЖНО:** Никогда не коммить `.env.local` в Git! Он уже должен быть в `.gitignore`.

### 5. Активация кода

После установки SDK открой файл `app/api/payments/create/route.ts` и:

1. Раскомментируй код внутри функции (убери `/*` и `*/`)
2. Удали строки с `TODO` и заглушками

### 6. Настройка Webhook

1. В личном кабинете ЮKassa перейди в "Настройки" → "Webhook"
2. Укажи URL: `https://твой-домен.ru/api/payments/webhook`
3. Выбери события: `payment.succeeded` и `payment.canceled`
4. Сохрани

**Для локальной разработки:**
- Используй ngrok или подобный сервис для проброса локального порта
- Или тестируй на продакшене

### 7. Проверка работы

1. Запусти сайт: `npm run dev`
2. Зайди на главную страницу
3. Нажми "Пополнить копилку"
4. Введи тестовую сумму (например, 100₽)
5. Нажми "Оплатить"
6. Тебя перенаправит на страницу оплаты ЮKassa
7. Используй тестовую карту: `5555 5555 5555 4444` (любая дата в будущем, любой CVC)
8. После оплаты вернёшься на страницу успеха

## Комиссии

- **Карты:** ~2.8% + 15₽ за операцию
- **СБП (Система быстрых платежей):** ~0.4-0.7%
- **Электронные кошельки:** зависит от кошелька

Комиссия вычитается автоматически — на твой счёт придёт сумма за вычетом комиссии.

## Безопасность

- Никогда не публикуй `YOOKASSA_SECRET_KEY` в открытом доступе
- Используй HTTPS на продакшене (обязательно для webhook)
- Проверяй подпись в webhook (код уже есть, нужно раскомментировать после настройки)

## Проблемы?

- **"Платёжная система не настроена"** — проверь `.env.local`
- **"SDK не установлен"** — выполни `npm install @yookassa/sdk`
- **Webhook не работает** — проверь URL и HTTPS
- **Платежи не проходят** — проверь статус аккаунта в ЮKassa

## Альтернативы

Если ЮKassa не подходит, можно использовать:
- **CloudPayments** — похожая система, чуть сложнее настройка
- **ЮMoney** — напрямую через их API (сложнее)
- **Tinkoff Business** — если есть бизнес-счёт



