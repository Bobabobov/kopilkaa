# –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ /register –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π

## ‚úÖ –°–¢–ê–¢–£–°: –ó–ê–©–ò–©–ï–ù–û –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π!

### üõ°Ô∏è –ê–Ω–∞–ª–∏–∑ API endpoint `/api/auth/register`:

#### 1. **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**

```typescript
// ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ —Å—Ç—Ä–æ–∫–∞–º
const email = String(body?.email ?? "")
  .trim()
  .toLowerCase();
const password = String(body?.password ?? "");
const name = String(body?.name ?? body?.username ?? "").trim();
```

#### 2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**

```typescript
// ‚úÖ Email –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ regex
if (!/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(email))
  return bad("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email");

// ‚úÖ –ü–∞—Ä–æ–ª—å - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã
if (password.length < 8 || password.length > 72)
  return bad("–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 8‚Äì72 —Å–∏–º–≤–æ–ª–∞");
```

#### 3. **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î —á–µ—Ä–µ–∑ Prisma:**

```typescript
// ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û - Prisma –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç
const exists = await prisma.user.findUnique({
  where: { email }, // email —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω
  select: { id: true },
});

// ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û - –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
const user = await prisma.user.create({
  data: {
    email, // —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω
    passwordHash, // —Ö–µ—à–∏—Ä–æ–≤–∞–Ω
    name: name || null, // —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω
    role: "USER",
  },
});
```

#### 4. **–ó–∞—â–∏—Ç–∞ –ø–∞—Ä–æ–ª–µ–π:**

```typescript
// ‚úÖ –ü–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è —Å bcrypt
const passwordHash = await bcrypt.hash(password, 10);
```

#### 5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ë–î:**

```typescript
// ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è email
if (err?.code === "P2002") return bad("–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω", 409);
```

### üõ°Ô∏è –ê–Ω–∞–ª–∏–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ `/register`:

#### 1. **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**

```typescript
// ‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ JSON.stringify
body: JSON.stringify({
  email: formData.email.trim().toLowerCase(),
  password: formData.password,
  name: formData.name.trim(),
});
```

#### 2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:**

```typescript
// ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ email —Ñ–æ—Ä–º–∞—Ç–∞
if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email)) {
  newErrors.email = "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å";
}

// ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –∏–º–µ–Ω–∏
if (formData.name.trim().length < 2) {
  newErrors.name = "–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞";
}

// ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
if (formData.password.length < 8) {
  newErrors.password = "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤";
}
```

### üîí **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞:**

1. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. **–°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. **Prisma ORM** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ SQL
4. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π** - bcrypt –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### üö´ **–ß—Ç–æ –ù–ï –Ω–∞–π–¥–µ–Ω–æ (—Ö–æ—Ä–æ—à–æ):**

- ‚ùå –ù–µ—Ç `$queryRaw()` –∏–ª–∏ raw SQL
- ‚ùå –ù–µ—Ç –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
- ‚ùå –ù–µ—Ç `eval()` –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- ‚ùå –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `JSON.parse()` —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### üìä **–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä—ã –∞—Ç–∞–∫:**

| –í–µ–∫—Ç–æ—Ä –∞—Ç–∞–∫–∏             | –°—Ç–∞—Ç—É—Å      | –ó–∞—â–∏—Ç–∞              |
| ------------------------ | ----------- | ------------------- |
| SQL Injection –≤ email    | üü¢ –ó–∞—â–∏—â–µ–Ω–æ | Prisma ORM          |
| SQL Injection –≤ password | üü¢ –ó–∞—â–∏—â–µ–Ω–æ | Prisma ORM          |
| SQL Injection –≤ name     | üü¢ –ó–∞—â–∏—â–µ–Ω–æ | Prisma ORM          |
| XSS –≤ –ø–æ–ª—è—Ö —Ñ–æ—Ä–º—ã        | üü¢ –ó–∞—â–∏—â–µ–Ω–æ | String() –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ |
| –ü–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ   | üü¢ –ó–∞—â–∏—â–µ–Ω–æ | bcrypt —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ  |

### üéØ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:**

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ `/register` –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–©–ò–©–ï–ù–ê –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π!**

**–ü—Ä–∏—á–∏–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Prisma ORM –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ raw SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

1. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Prisma –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. –ù–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ `$queryRaw()` –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ
4. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

---

**–í–µ—Ä–¥–∏–∫—Ç: üü¢ –ë–ï–ó–û–ü–ê–°–ù–û** - SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã!



